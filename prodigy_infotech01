from fastapi import FastAPI, HTTPException
from pydantic import BaseModel, EmailStr
from uuid import uuid4, UUID
from typing import Dict

app = FastAPI()

# In-memory data store
users: Dict[UUID, dict] = {}

# User model
class User(BaseModel):
    name: str
    email: EmailStr
    age: int

# Create User
@app.post("/users/")
def create_user(user: User):
    user_id = uuid4()
    users[user_id] = user.dict()
    return {"id": user_id, **user.dict()}

# Read User
@app.get("/users/{user_id}")
def read_user(user_id: UUID):
    if user_id not in users:
        raise HTTPException(status_code=404, detail="User not found")
    return {"id": user_id, **users[user_id]}

# Update User
@app.put("/users/{user_id}")
def update_user(user_id: UUID, updated_user: User):
    if user_id not in users:
        raise HTTPException(status_code=404, detail="User not found")
    users[user_id] = updated_user.dict()
    return {"id": user_id, **updated_user.dict()}

# Delete User
@app.delete("/users/{user_id}")
def delete_user(user_id: UUID):
    if user_id not in users:
        raise HTTPException(status_code=404, detail="User not found")
    del users[user_id]
    return {"message": "User deleted successfully"}
